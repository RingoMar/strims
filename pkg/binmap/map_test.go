package binmap

import (
	"log"
	"testing"
)

func TestMap_NewFromString(t *testing.T) {
	s := `freeTop: 6, allocCount: 5, cellCount: 15, rootBin: 1023
0      00000000000000000000000000000100 M 00000000000000000000000000011010 M
1      11111111111111111111111111111111 B                                2 R
2                                     3 R 00000000000000000000000000000000 B
3      11111111111111111111111111111111 B                                4 R
4      11111111111111111111111111111111 B                                5 R
5      11111111111111111111111111111111 B 00011111111111111111111111111111 B
6                                     7 F
7                                     8 F
8                                     9 F
9                                    10 F
10                                   11 F
11                                   12 F
12                                   13 F
13                                   14 F
14                                   15 F
15                                    0 F
`
	m := newFromString(s)
	if m.String() != s {
		t.Fail()
	}
}

func TestMap_SetBinLock(t *testing.T) {
	s := `freeTop: 6, allocCount: 5, cellCount: 15, rootBin: 1023
0      00000000000000000000000000000100 M 00000000000000000000000000011010 M
1      11111111111111111111111111111111 B                                2 R
2                                     3 R 00000000000000000000000000000000 B
3      11111111111111111111111111111111 B                                4 R
4      11111111111111111111111111111111 B                                5 R
5      11111111111111111111111111111111 B 00000000000000000000011111111111 B
6                                     7 F
7                                     8 F
8                                     9 F
9                                    10 F
10                                   11 F
11                                   12 F
12                                   13 F
13                                   14 F
14                                   15 F
15                                    0 F
`
	m := newFromString(s)
	m.EmptyAt(6170)
	m.Reset(6170)
	log.Println(m.String())
	s = `freeTop: 30, allocCount: 23, cellCount: 34, rootBin: 16383
0      00000100000101100000000001011110 M 00011011100011000000011110100010 M
1                                    17 R                                2 R
2                                     3 R 00000000000000000000000000000000 B
3                                     4 R 00000000000000000000000000000000 B
4                                     5 R 00000000000000000000000000000000 B
5      11111111111111111111111111111111 B                                6 R
6                                     7 R 00000000000000000000000000000000 B
7      11111111111111111111111111111111 B                                8 R
8      11111111111111111111111111111111 B                               16 R
9      00000000000000000000000000000000 B                               10 R
10     00000000000000000000000000000000 B                               29 R
11                                   12 F
12                                   13 F
13                                   14 F
14                                   15 F
15                                    0 F
16     00000000000000000000000000111111 B 00000000000000000000000000000000 B
17                                   18 R 11111111111111111111111111111111 B
18                                   19 R                               26 R
19     11111111111111111111111111111111 B                               24 R
20                                   21 R 00000000000000000000000000000000 B
21     11111111111111111111111111111111 B 00000001111111111111111111111111 B
22                                   11 F
23     11111111111111111111111111111111 B                               20 R
24     11111111111111111111111111111111 B                               25 R
25     11111111111111111111111111111111 B                               23 R
26                                   27 R 11111111111111111111111111111111 B
27     00000000000000000000000000000000 B                               28 R
28     00000000000000000000000000000000 B                                9 R
29     11111111111111111111111111110000 B 11111111111111111111111111111111 B
30                                   31 F
31                                   33 F
32     00000000000000000000000000000000 M 00000000000000000000000000000000 M
33                                   34 F
34                                   35 F
35                                   22 F
`
	m = newFromString(s)
	m.EmptyAt(6170)
	m.Reset(6170)
	log.Println(m.String())
}
